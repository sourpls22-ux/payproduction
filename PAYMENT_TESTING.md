# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –æ–ø–ª–∞—Ç—ã

## üìã –ß—Ç–æ –º—ã —Å–æ–∑–¥–∞–ª–∏

### ‚úÖ –ù–æ–≤–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –æ–ø–ª–∞—Ç—ã
- **–ó–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "üß™ Test Payment (New System)"** –≤ TopUp.jsx
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å —ç–º–æ–¥–∑–∏-–ª–æ–≥–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –£–ª—É—á—à–µ–Ω–Ω—ã–µ callback'–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π backend
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `testMode` –∏ `customOrderId` –≤ `/api/topup`
- –ù–æ–≤—ã–π endpoint `/api/test-payment/:orderId` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏-–ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
- `test-payment.js` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ flow'–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞, —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞, –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –±–∞–ª–∞–Ω—Å–∞

## üöÄ –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
node test-payment.js
```

### 2. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/topup`
2. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, $1)
3. –ù–∞–∂–º–∏—Ç–µ **–∑–µ–ª–µ–Ω—É—é –∫–Ω–æ–ø–∫—É "üß™ Test Payment (New System)"**
4. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ backend'–∞

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

```bash
# –ù–∞ VPS
cd /var/www/payproduction
git pull origin main
pm2 restart kissblow-backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs kissblow-backend --lines 20
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- `üß™ [TEST PAYMENT]` - –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- `üß™ [TEST PAYMENT] ‚úÖ Success callback triggered` - —É—Å–ø–µ—à–Ω—ã–π callback
- `üß™ [TEST PAYMENT] ‚ùå Error callback triggered` - –æ—à–∏–±–∫–∞

### –õ–æ–≥–∏ –≤ backend
- `üß™ [TOPUP]` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `üß™ [CREATE PAYMENT]` - –¥–µ—Ç–∞–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è
- `üß™ [TEST PAYMENT]` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- `üß™ [TEST WEBHOOK]` - —Å–∏–º—É–ª—è—Ü–∏—è webhook'–∞

## üéØ –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–π flow
1. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞** - –∫–Ω–æ–ø–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–µ—Ç—Å—è
2. **ATLOS SDK** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
3. **Callback'–∏** - —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ
4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - –ø–ª–∞—Ç–µ–∂ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º

### ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π flow
1. **–¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞** - —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ —Å `testMode: true`
2. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞** - `/api/test-payment/:orderId` —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞** - –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è
4. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç –±–∞–ª–∞–Ω—Å

### ‚úÖ Webhook flow
1. **ATLOS webhook** - –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ `/api/webhooks/atlos`
2. **–ü–æ–¥–ø–∏—Å—å** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞** - –ø–ª–∞—Ç–µ–∂ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∏ –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
4. **Resync** - `/api/payments/resync` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ATLOS SDK –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSP –≤ `index.html`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `https://atlos.io`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

### Webhook –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ ATLOS –ø–∞–Ω–µ–ª–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL: `https://kissblow.me/api/webhooks/atlos`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤

### –ë–∞–ª–∞–Ω—Å –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ webhook'–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ –±–∞–∑–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/api/payments/resync` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# PM2 —Å—Ç–∞—Ç—É—Å
pm2 status

# –õ–æ–≥–∏ backend'–∞
pm2 logs kissblow-backend --lines 50

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sqlite3 database.sqlite "SELECT * FROM payments ORDER BY created_at DESC LIMIT 10;"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook'–æ–≤
```bash
# –¢–µ—Å—Ç–æ–≤—ã–π webhook
curl -X POST https://kissblow.me/api/test-payment/TEST_ORDER_ID \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"action": "complete"}'
```

## üéâ –ì–æ—Ç–æ–≤–æ!

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–µ–ª–µ–Ω—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
